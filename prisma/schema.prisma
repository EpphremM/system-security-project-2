


generator client {
  provider        = "prisma-client"
  output          = "../src/generated/prisma"
  
  previewFeatures = ["postgresqlExtensions", "fullTextSearchPostgres"]
}

datasource db {
  provider = "postgresql"
}





model User {
  id                String        @id @default(uuid())
  email             String        @unique
  emailVerified     DateTime?
  name              String?
  department        String
  roleId            String? 
  role              Role?         @relation(fields: [roleId], references: [id])
  securityClearance SecurityLevel @default(INTERNAL)

  
  passwordHash    String? 
  mfaSecret       String?
  mfaEnabled      Boolean          @default(false)
  webauthnDevices WebAuthnDevice[]

  
  passwordHistory     PasswordHistory[]
  failedLoginAttempts Int               @default(0)
  accountLockedUntil  DateTime?
  lastFailedLoginAt   DateTime?

  
  preferredAuthMethod AuthMethod @default(PASSWORD)
  sessionVersion      Int        @default(1) 

  
  clearance        UserClearance?
  clearanceHistory ClearanceHistory[]
  trustedSubject   Boolean            @default(false) 

  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  lastLoginAt       DateTime?
  passwordChangedAt DateTime?
  passwordExpiresAt DateTime? 

  
  image            String?
  twoFactorEnabled Boolean @default(false) @map("two_factor_enabled")
  twoFactorSecret  String? @map("two_factor_secret")

  
  legacyRole UserRole? @default(USER)

  
  visitors              Visitor[]
  approvedVisitors      Visitor[]                @relation("approvedBy")
  accessPolicies        AccessPolicy[]           @relation("PolicyOwner")
  permissions           UserPermission[]
  auditLogs             AuditLog[]
  sessions              Session[]
  accounts              Account[]
  accessLogs            AccessLog[]
  visitorLogs           VisitorLog[]
  ownedResources        Resource[]               @relation("ResourceOwner") 
  createdBackups        BackupLog[]              @relation("BackupCreator")
  updatedConfigs        SystemConfig[]           @relation("ConfigUpdater")
  mfaBackupCodes        MFABackupCode[]
  mfaEmergencyTokens    MFAEmergencyToken[]
  mfaEmailOTPs          MFAEmailOTP[]
  clearanceCompartments ClearanceCompartment[]   @relation("ClearanceUser")
  resourcePermissions   ResourcePermission[]
  sharingLinks          SharingLink[]
  roleAssignments       RoleAssignment[]
  roleRequests          RoleRequest[]            @relation("RoleRequestUser")
  roleRequestApprovals  RoleRequest[]            @relation("RoleRequestApprover")
  roleReviews           RoleReview[]
  deviceProfiles        DeviceProfile[]
  userAttributes        UserAttribute[]
  approvalRequests      VisitorApprovalRequest[] @relation("ApprovalHost")

  
  @@index([email])
  @@index([department, legacyRole])
  @@index([roleId])
  @@index([securityClearance])
  @@index([preferredAuthMethod])
  @@index([lastLoginAt])
  @@index([sessionVersion])
  @@map("users")
}

model WebAuthnDevice {
  id           String   @id @default(uuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  credentialId String   @unique
  publicKey    String   @db.Text
  counter      Int      @default(0)
  transports   String[] 
  deviceName   String?

  createdAt  DateTime  @default(now())
  lastUsedAt DateTime?

  @@index([userId])
  @@index([credentialId])
  @@map("webauthn_devices")
}

model Account {
  id                String  @id @default(uuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@map("accounts")
}





model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  
  ipAddress         String?
  userAgent         String?
  deviceFingerprint String? 
  location          String? 
  isActive          Boolean   @default(true)
  revokedAt         DateTime? 
  revokedReason     String? 

  
  requiresMFA    Boolean  @default(false)
  mfaVerified    Boolean  @default(false)
  lastActivityAt DateTime @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([expires])
  @@index([sessionToken])
  @@index([isActive])
  @@index([revokedAt])
  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@index([expires])
  @@map("verification_tokens")
}





model Role {
  id          String  @id @default(uuid())
  name        String  @unique
  description String? @db.Text
  level       Int     @default(0) 

  
  parentId String?
  parent   Role?   @relation("RoleHierarchy", fields: [parentId], references: [id])
  children Role[]  @relation("RoleHierarchy")

  
  permissions RolePermission[]

  
  accessPolicies AccessPolicy[] @relation("PolicyRole")

  
  users           User[]
  roleAssignments RoleAssignment[]

  
  roleRequests RoleRequest[]
  roleReviews  RoleReview[]

  
  isSystem Boolean @default(false) 
  enabled  Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([parentId])
  @@index([level])
  @@index([enabled])
  @@map("roles")
}





model Permission {
  id          String  @id @default(uuid())
  name        String  @unique
  resource    String 
  action      String 
  description String? @db.Text

  
  rolePermissions RolePermission[]
  userPermissions UserPermission[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([resource, action])
  @@index([resource])
  @@index([action])
  @@map("permissions")
}

model RolePermission {
  id           String     @id @default(uuid())
  roleId       String
  permissionId String
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  
  granted    Boolean @default(true) 
  conditions Json? 

  createdAt DateTime @default(now())

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
  @@map("role_permissions")
}

model UserPermission {
  id           String     @id @default(uuid())
  userId       String
  permissionId String
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  
  granted    Boolean   @default(true)
  conditions Json? 
  expiresAt  DateTime? 

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, permissionId])
  @@index([userId])
  @@index([permissionId])
  @@index([expiresAt])
  @@map("user_permissions")
}





model AccessPolicy {
  id          String  @id @default(uuid())
  name        String
  description String? @db.Text

  
  policyType PolicyType

  
  resource String 
  action   String 

  
  minSecurityLabel SecurityLevel? 
  maxSecurityLabel SecurityLevel? 

  
  ownerId String? 
  owner   User?   @relation("PolicyOwner", fields: [ownerId], references: [id])

  
  requiredRoleId String?
  requiredRole   Role?   @relation("PolicyRole", fields: [requiredRoleId], references: [id])

  
  rules  Json? 
  ruleId String? 
  rule   AccessRule? @relation(fields: [ruleId], references: [id])

  
  attributes Json? 

  
  conditions Json? 

  
  priority Int     @default(0) 
  enabled  Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([policyType])
  @@index([resource, action])
  @@index([ownerId])
  @@index([requiredRoleId])
  @@index([ruleId])
  @@index([enabled, priority])
  @@map("access_policies")
}





model SecurityLabel {
  id          String  @id @default(uuid())
  name        String  @unique
  level       Int     @default(0) 
  description String? @db.Text

  
  classification SecurityLevel
  dataCategory   DataCategory

  
  compartments String[] 

  
  parentId String?
  parent   SecurityLabel?  @relation("LabelHierarchy", fields: [parentId], references: [id])
  children SecurityLabel[] @relation("LabelHierarchy")

  
  resources Resource[]

  
  isSystem Boolean @default(false)
  enabled  Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([parentId])
  @@index([level])
  @@index([classification])
  @@index([enabled])
  @@map("security_labels")
}





model Resource {
  id         String @id @default(uuid())
  type       String 
  resourceId String 

  
  ownerId String
  owner   User   @relation("ResourceOwner", fields: [ownerId], references: [id])

  
  securityLabelId String
  securityLabel   SecurityLabel @relation(fields: [securityLabelId], references: [id])

  
  parentId String? 
  parent   Resource?  @relation("ResourceHierarchy", fields: [parentId], references: [id])
  children Resource[] @relation("ResourceHierarchy")

  
  permissions Json? 

  
  sharedPermissions ResourcePermission[]

  
  ownershipTransfers OwnershipTransfer[]

  
  sharingLinks SharingLink[]

  
  resourceAttributes ResourceAttribute[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([type, resourceId])
  @@index([ownerId])
  @@index([securityLabelId])
  @@index([type, resourceId])
  @@index([parentId])
  @@map("resources")
}





model AuditLog {
  id     String  @id @default(uuid())
  userId String?
  user   User?   @relation(fields: [userId], references: [id], onDelete: SetNull)

  
  category LogCategory @default(USER_ACTIVITY)
  logType  LogType 

  
  action     String
  resource   String
  resourceId String?

  
  securityLabel SecurityLevel @default(INTERNAL)

  
  encryptedDetails String? @db.Text 
  encryptionKeyId  String? 

  
  hashChain        String? 
  previousHash     String? 
  digitalSignature String? 
  batchId          String? 
  isTampered       Boolean @default(false) 

  
  details   Json? 
  ipAddress String?
  userAgent String?
  location  String? 

  
  beforeState Json? 
  afterState  Json? 

  
  accessGranted Boolean? 
  policyId      String? 
  policyType    PolicyType? 
  denialReason  String?     @db.Text 

  
  duration           Int? 
  performanceMetrics Json? 

  
  errorCode    String?
  errorMessage String? @db.Text
  stackTrace   String? @db.Text

  
  retentionUntil   DateTime? 
  complianceTags   String[] 
  subjectRequestId String? 

  
  exportedAt   DateTime?
  exportedBy   String?
  exportFormat String? 

  createdAt      DateTime   @default(now())
  hashChainEntry HashChain?
  sourceAlerts   Alert[]

  @@index([userId])
  @@index([category])
  @@index([logType])
  @@index([action])
  @@index([resource, resourceId])
  @@index([securityLabel])
  @@index([accessGranted])
  @@index([policyType])
  @@index([createdAt])
  @@index([retentionUntil])
  @@index([complianceTags])
  @@index([subjectRequestId])
  @@index([batchId])
  @@index([hashChain])
  @@index([isTampered])
  @@map("audit_logs")
}

enum LogCategory {
  SECURITY 
  USER_ACTIVITY 
  SYSTEM 
  COMPLIANCE 
}

enum LogType {
  
  AUTH_SUCCESS
  AUTH_FAILURE
  AUTH_LOCKOUT
  MFA_SUCCESS
  MFA_FAILURE
  ACCESS_GRANTED
  ACCESS_DENIED
  POLICY_VIOLATION
  SECURITY_CONFIG_CHANGE
  CLEARANCE_CHANGE
  PERMISSION_CHANGE

  
  DATA_ACCESS
  DATA_CREATE
  DATA_UPDATE
  DATA_DELETE
  DATA_EXPORT
  PERMISSION_GRANT
  PERMISSION_REVOKE
  ROLE_ASSIGNED
  ROLE_REVOKED
  OWNERSHIP_TRANSFER

  
  APP_START
  APP_STOP
  APP_ERROR
  BACKUP_START
  BACKUP_COMPLETE
  BACKUP_FAILED
  BACKUP_VERIFIED
  PERFORMANCE_METRIC
  EXCEPTION
  CONFIG_CHANGE

  
  SUBJECT_ACCESS_REQUEST
  DATA_RETENTION_ENFORCED
  DATA_DELETED_RETENTION
  AUDIT_EXPORT
  COMPLIANCE_CHECK
  GDPR_REQUEST
  HIPAA_AUDIT
}





model BackupLog {
  id String @id @default(uuid())

  
  backupType BackupType
  backupName String
  backupPath String? 

  
  storageLocation StorageLocation @default(PRIMARY)
  primaryPath     String? 
  secondaryPath   String? 
  tertiaryPath    String? 
  airGappedPath   String? 

  
  size        BigInt? 
  recordCount Int? 

  
  checksum           String? 
  verified           Boolean   @default(false)
  verifiedAt         DateTime?
  verificationMethod String? 

  
  preBackupChecksPassed   Boolean @default(false)
  postBackupChecksPassed  Boolean @default(false)
  consistencyCheckResults Json? 

  
  encrypted           Boolean @default(true)
  encryptionKeyId     String? 
  encryptionAlgorithm String? @default("AES-256-GCM")

  
  status       BackupStatus @default(IN_PROGRESS)
  errorMessage String?      @db.Text

  
  restorationTested     Boolean   @default(false)
  restorationTestDate   DateTime?
  restorationTestResult String? 
  restorationTestNotes  String?   @db.Text

  
  expiresAt     DateTime? 
  retentionDays Int? 

  
  scheduledBackupId String? 
  scheduleType      String? 

  
  createdById    String?
  createdBy      User?                 @relation("BackupCreator", fields: [createdById], references: [id])
  recoveryPlanId String?
  recoveryPlan   DisasterRecoveryPlan? @relation(fields: [recoveryPlanId], references: [id])

  startedAt   DateTime  @default(now())
  completedAt DateTime?
  createdAt   DateTime  @default(now())

  @@index([backupType])
  @@index([status])
  @@index([storageLocation])
  @@index([createdById])
  @@index([startedAt])
  @@index([expiresAt])
  @@index([verified])
  @@index([restorationTested])
  @@map("backup_logs")
}





model SystemConfig {
  id    String @id @default(uuid())
  key   String @unique
  value String @db.Text 

  
  encrypted           Boolean @default(true)
  encryptionKeyId     String? 
  encryptionAlgorithm String? @default("AES-256-GCM")

  
  category    String? 
  description String? @db.Text
  sensitive   Boolean @default(false) 

  
  restricted Boolean @default(false) 

  
  version       Int     @default(1)
  previousValue String? @db.Text 

  
  updatedById String?
  updatedBy   User?   @relation("ConfigUpdater", fields: [updatedById], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([key])
  @@index([category])
  @@index([sensitive])
  @@index([restricted])
  @@map("system_configs")
}





model Visitor {
  id        String  @id @default(uuid())
  
  firstName String
  lastName  String
  email     String?
  phone     String
  company   String

  
  purpose VisitPurpose
  hostId  String
  host    User         @relation(fields: [hostId], references: [id])

  
  securityLabel SecurityLevel @default(PUBLIC)
  dataCategory  DataCategory  @default(GENERAL)

  
  scheduledDate  DateTime
  scheduledStart DateTime
  scheduledEnd   DateTime
  actualCheckIn  DateTime?
  actualCheckOut DateTime?

  
  status       VisitStatus @default(PENDING)
  approvalDate DateTime?
  approvedById String?
  approvedBy   User?       @relation(fields: [approvedById], references: [id], name: "approvedBy")

  
  documentId          String? 
  idDocumentEncrypted String? @db.Text 

  
  qrCode          String? 
  qrCodeExpiresAt DateTime? 
  badgeNumber     String? 
  badgePrintedAt  DateTime? 
  badgeExpiresAt  DateTime? 

  
  isGroupVisit Boolean @default(false)
  groupId      String? 
  groupSize    Int? 

  
  approvalRequestedAt       DateTime? 
  approvalEscalatedAt       DateTime? 
  escalationReason          String?   @db.Text
  requiresSecurityClearance Boolean   @default(false)
  securityClearanceChecked  Boolean   @default(false)

  
  checkedInBy    String? 
  checkedOutBy   String? 
  idVerifiedAt   DateTime? 
  hostNotifiedAt DateTime? 

  
  retentionPeriodStart DateTime? 
  retentionPeriodDays  Int? 

  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  
  accessLogs       AccessLog[]
  visitorLogs      VisitorLog[]
  approvalRequests VisitorApprovalRequest[]
  areaAccess       VisitorAreaAccess[]
  digitalAccess    VisitorDigitalAccess?

  
  @@index([hostId, status])
  @@index([scheduledDate])
  @@index([status, scheduledDate])
  @@index([securityLabel, createdAt])
  @@index([approvedById])
  @@index([qrCode])
  @@index([groupId])
  @@index([approvalRequestedAt])
  @@map("visitors")
}





model VisitorApprovalRequest {
  id        String  @id @default(uuid())
  visitorId String
  visitor   Visitor @relation(fields: [visitorId], references: [id], onDelete: Cascade)

  
  requestedAt DateTime @default(now())
  requestedBy String? 

  
  hostId String 
  host   User                  @relation("ApprovalHost", fields: [hostId], references: [id])
  status ApprovalRequestStatus @default(PENDING)

  
  escalatedTo      String? 
  escalatedAt      DateTime?
  escalationReason String?   @db.Text

  
  approvedAt      DateTime?
  approvedBy      String?
  rejectedAt      DateTime?
  rejectedBy      String?
  rejectionReason String?   @db.Text

  
  requiresSecurityClearance Boolean @default(false)
  securityClearanceChecked  Boolean @default(false)
  securityClearanceResult   String? 

  
  hostNotifiedAt       DateTime?
  escalationNotifiedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([visitorId])
  @@index([hostId])
  @@index([status])
  @@index([requestedAt])
  @@index([escalatedTo])
  @@map("visitor_approval_requests")
}

enum ApprovalRequestStatus {
  PENDING
  APPROVED
  REJECTED
  ESCALATED
  EXPIRED
}

model VisitorLog {
  id          String        @id @default(uuid())
  visitorId   String
  userId      String? 
  action      VisitorAction
  description String?       @db.Text
  metadata    Json? 
  createdAt   DateTime      @default(now())

  
  visitor Visitor @relation(fields: [visitorId], references: [id], onDelete: Cascade)
  user    User?   @relation(fields: [userId], references: [id])

  @@index([visitorId])
  @@index([userId])
  @@index([action])
  @@index([createdAt])
  @@map("visitor_logs")
}

model AccessLog {
  id        String       @id @default(uuid())
  visitorId String?
  userId    String?
  action    AccessAction
  location  String? 
  ipAddress String?
  userAgent String?
  metadata  Json?
  createdAt DateTime     @default(now())

  
  visitor Visitor? @relation(fields: [visitorId], references: [id])
  user    User?    @relation(fields: [userId], references: [id])

  @@index([visitorId])
  @@index([userId])
  @@index([action])
  @@index([location])
  @@index([createdAt])
  @@map("access_logs")
}

enum UserRole {
  VISITOR
  USER
  STAFF
  RECEPTIONIST
  DEPT_HEAD
  HR
  SECURITY
  IT_ADMIN
  ADMIN
  SUPER_ADMIN
}

enum SecurityLevel {
  PUBLIC
  INTERNAL
  CONFIDENTIAL
  RESTRICTED
  TOP_SECRET
}

enum AuthMethod {
  PASSWORD
  WEBAUTHN
  OTP
  SSO
}

enum PolicyType {
  MAC 
  DAC 
  RBAC 
  RuBAC 
  ABAC 
  HYBRID 
}

enum VisitStatus {
  PENDING
  APPROVED
  REJECTED
  CHECKED_IN
  CHECKED_OUT
  CANCELLED
  EXPIRED
  NO_SHOW
}

enum VisitPurpose {
  MEETING
  INTERVIEW
  DELIVERY
  MAINTENANCE
  TOUR
  TRAINING
  CONSULTATION
  OTHER
}

enum DataCategory {
  GENERAL
  PERSONAL
  CONFIDENTIAL
  RESTRICTED
  CLASSIFIED
}

enum VisitorAction {
  CREATED
  UPDATED
  CHECKED_IN
  CHECKED_OUT
  CANCELLED
  APPROVED
  REJECTED
  REMINDER_SENT
}

enum AccessAction {
  ENTRY
  EXIT
  DENIED
  ESCORTED
}

enum BackupType {
  FULL
  INCREMENTAL
  DIFFERENTIAL
  TRANSACTION_LOG
  CONFIGURATION
  MANUAL
  SCHEDULED
}

enum StorageLocation {
  PRIMARY 
  SECONDARY 
  TERTIARY 
  AIR_GAPPED 
}

enum BackupStatus {
  IN_PROGRESS
  COMPLETED
  FAILED
  VERIFIED
  EXPIRED
}





model PasswordHistory {
  id           String   @id @default(uuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  passwordHash String 
  createdAt    DateTime @default(now())

  @@index([userId])
  @@index([userId, createdAt])
  @@map("password_history")
}

model AccountLockout {
  id          String      @id @default(uuid())
  identifier  String 
  type        LockoutType
  attempts    Int         @default(1)
  lockedUntil DateTime
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@unique([identifier, type])
  @@index([lockedUntil])
  @@index([type])
  @@map("account_lockouts")
}

enum LockoutType {
  USER_ACCOUNT
  IP_ADDRESS
}





model UserClearance {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  
  level SecurityLevel

  
  compartments String[] 

  
  assignedAt   DateTime        @default(now())
  assignedBy   String? 
  expiresAt    DateTime? 
  nextReviewAt DateTime 
  status       ClearanceStatus @default(ACTIVE)

  
  escalationRequested   Boolean   @default(false)
  escalationReason      String?   @db.Text
  escalationRequestedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([level])
  @@index([status])
  @@index([nextReviewAt])
  @@map("user_clearances")
}

model ClearanceHistory {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  
  previousLevel        SecurityLevel?
  newLevel             SecurityLevel
  previousCompartments String[]
  newCompartments      String[]

  
  changedBy  String? 
  reason     String?             @db.Text
  changeType ClearanceChangeType

  createdAt DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
  @@map("clearance_history")
}

model ClearanceCompartment {
  id          String  @id @default(uuid())
  name        String  @unique
  description String? @db.Text

  
  type CompartmentType

  
  users User[] @relation("ClearanceUser")

  
  isSystem Boolean @default(false)
  enabled  Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type])
  @@index([enabled])
  @@map("clearance_compartments")
}

enum ClearanceStatus {
  ACTIVE
  PENDING
  SUSPENDED
  REVOKED
  EXPIRED
}

enum ClearanceChangeType {
  ASSIGNED
  UPGRADED
  DOWNGRADED
  REVOKED
  COMPARTMENT_ADDED
  COMPARTMENT_REMOVED
  REVIEWED
  ESCALATED
}

enum CompartmentType {
  FINANCIAL
  PERSONNEL
  OPERATIONAL
  VISITOR
  IT
  LEGAL
  EXECUTIVE
  CUSTOM
}





model ResourcePermission {
  id         String   @id @default(uuid())
  resourceId String
  resource   Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)

  
  userId  String? 
  user    User?   @relation(fields: [userId], references: [id], onDelete: Cascade)
  groupId String? 

  
  canRead    Boolean @default(false)
  canWrite   Boolean @default(false)
  canExecute Boolean @default(false)
  canDelete  Boolean @default(false)
  canShare   Boolean @default(false) 

  
  expiresAt DateTime?

  
  grantedBy String 
  grantedAt DateTime @default(now())
  reason    String?  @db.Text

  
  inherited     Boolean @default(false)
  inheritedFrom String? 

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([resourceId])
  @@index([userId])
  @@index([groupId])
  @@index([expiresAt])
  @@map("resource_permissions")
}

model OwnershipTransfer {
  id         String   @id @default(uuid())
  resourceId String
  resource   Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)

  
  fromUserId  String 
  toUserId    String 
  requestedBy String 
  approvedBy  String? 

  
  status          TransferStatus @default(PENDING)
  reason          String?        @db.Text
  rejectionReason String?        @db.Text

  
  requestedAt DateTime  @default(now())
  approvedAt  DateTime?
  completedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([resourceId])
  @@index([fromUserId])
  @@index([toUserId])
  @@index([status])
  @@map("ownership_transfers")
}

model SharingLink {
  id         String   @id @default(uuid())
  resourceId String
  resource   Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)

  
  token     String @unique 
  createdBy String 
  creator   User   @relation(fields: [createdBy], references: [id])

  
  canRead    Boolean @default(true)
  canWrite   Boolean @default(false)
  canExecute Boolean @default(false)
  canDelete  Boolean @default(false)
  canShare   Boolean @default(false)

  
  expiresAt DateTime?
  maxUses   Int? 
  useCount  Int       @default(0)

  
  password    String? 
  requireAuth Boolean @default(false) 

  
  allowedEmails  String[] 
  allowedDomains String[] 

  
  name        String? 
  description String? @db.Text

  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  lastUsedAt DateTime?

  @@index([resourceId])
  @@index([token])
  @@index([createdBy])
  @@index([expiresAt])
  @@map("sharing_links")
}

enum TransferStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
  CANCELLED
}





model RoleAssignment {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  roleId String
  role   Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)

  
  reviews RoleReview[] @relation("RoleReviewAssignment")

  
  assignedBy String 
  assignedAt DateTime @default(now())

  
  isTemporary Boolean   @default(false)
  expiresAt   DateTime?

  
  status AssignmentStatus @default(ACTIVE)

  
  lastReviewedAt DateTime?
  nextReviewAt   DateTime? 

  
  deprovisionedAt   DateTime?
  deprovisionReason String?   @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, roleId])
  @@index([userId])
  @@index([roleId])
  @@index([status])
  @@index([expiresAt])
  @@index([nextReviewAt])
  @@map("role_assignments")
}

model RoleRequest {
  id     String @id @default(uuid())
  userId String
  user   User   @relation("RoleRequestUser", fields: [userId], references: [id], onDelete: Cascade)
  roleId String
  role   Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)

  
  requestedBy   String 
  requestedAt   DateTime @default(now())
  reason        String?  @db.Text
  justification String?  @db.Text

  
  status          RequestStatus @default(PENDING)
  approvedBy      String?
  approver        User?         @relation("RoleRequestApprover", fields: [approvedBy], references: [id])
  approvedAt      DateTime?
  rejectionReason String?       @db.Text

  
  isTemporary        Boolean   @default(false)
  requestedExpiresAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([roleId])
  @@index([status])
  @@index([requestedAt])
  @@map("role_requests")
}

model RoleReview {
  id           String          @id @default(uuid())
  roleId       String
  role         Role            @relation(fields: [roleId], references: [id], onDelete: Cascade)
  assignmentId String? 
  assignment   RoleAssignment? @relation("RoleReviewAssignment", fields: [assignmentId], references: [id], onDelete: Cascade)

  
  reviewedBy String 
  reviewer   User       @relation(fields: [reviewedBy], references: [id])
  reviewedAt DateTime   @default(now())
  reviewType ReviewType

  
  approved        Boolean
  notes           String? @db.Text
  recommendations String? @db.Text

  
  nextReviewAt DateTime 

  createdAt DateTime @default(now())

  @@index([roleId])
  @@index([assignmentId])
  @@index([reviewedAt])
  @@index([nextReviewAt])
  @@map("role_reviews")
}

enum AssignmentStatus {
  ACTIVE
  PENDING
  SUSPENDED
  REVOKED
  EXPIRED
  DEPROVISIONED
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum ReviewType {
  ANNUAL
  AD_HOC
  DEPROVISIONING
  ESCALATION
}





model AccessRule {
  id          String  @id @default(uuid())
  name        String
  description String? @db.Text

  
  ruleType RuleType

  
  config Json 

  
  enabled  Boolean @default(true)
  priority Int     @default(0) 

  
  emergencyOverride Boolean @default(false) 

  
  validFrom  DateTime?
  validUntil DateTime?

  
  policies AccessPolicy[]

  
  holidayScheduleId String?
  holidaySchedule   HolidaySchedule? @relation(fields: [holidayScheduleId], references: [id])

  
  ipWhitelistId String?
  ipWhitelist   IPWhitelist? @relation(fields: [ipWhitelistId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([ruleType])
  @@index([enabled])
  @@index([priority])
  @@index([validFrom, validUntil])
  @@index([holidayScheduleId])
  @@index([ipWhitelistId])
  @@map("access_rules")
}

model HolidaySchedule {
  id          String  @id @default(uuid())
  name        String
  description String? @db.Text

  
  startDate DateTime
  endDate   DateTime

  
  type HolidayType

  
  isRecurring       Boolean @default(false)
  recurrencePattern Json? 

  
  rules AccessRule[] @relation

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([startDate, endDate])
  @@index([type])
  @@map("holiday_schedules")
}

model IPWhitelist {
  id          String  @id @default(uuid())
  name        String
  description String? @db.Text

  
  ipRanges String[] 

  
  location String? 

  
  rules AccessRule[] @relation

  enabled Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([enabled])
  @@map("ip_whitelists")
}

model DeviceProfile {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  
  deviceId   String     @unique 
  deviceName String?
  deviceType DeviceType

  
  os             String? 
  osVersion      String?
  browser        String?
  browserVersion String?

  
  isCompanyManaged    Boolean @default(false)
  hasAntiMalware      Boolean @default(false)
  hasEncryptedStorage Boolean @default(false)

  
  lastSeen  DateTime @default(now())
  ipAddress String?
  userAgent String?

  
  trustLevel TrustLevel @default(UNKNOWN)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([deviceId])
  @@index([trustLevel])
  @@index([isCompanyManaged])
  @@map("device_profiles")
}

enum RuleType {
  TIME_BASED
  LOCATION_BASED
  DEVICE_BASED
  COMPOSITE 
}

enum HolidayType {
  PUBLIC_HOLIDAY
  COMPANY_HOLIDAY
  EMERGENCY_CLOSURE
  MAINTENANCE_WINDOW
}

enum DeviceType {
  DESKTOP
  LAPTOP
  MOBILE
  TABLET
  SERVER
  IOT
  UNKNOWN
}

enum TrustLevel {
  TRUSTED
  VERIFIED
  UNKNOWN
  UNTRUSTED
  BLOCKED
}





model AttributeDefinition {
  id          String  @id @default(uuid())
  name        String  @unique
  description String? @db.Text

  
  attributeType AttributeType
  category      AttributeCategory

  
  valueType     ValueType
  allowedValues String[] 
  defaultValue  String? 

  
  minValue String? 
  maxValue String? 
  pattern  String? 

  
  isSystem Boolean @default(false)
  enabled  Boolean @default(true)

  
  userAttributes     UserAttribute[]
  resourceAttributes ResourceAttribute[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([attributeType])
  @@index([category])
  @@index([enabled])
  @@map("attribute_definitions")
}

model UserAttribute {
  id          String              @id @default(uuid())
  userId      String
  user        User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  attributeId String
  attribute   AttributeDefinition @relation(fields: [attributeId], references: [id], onDelete: Cascade)

  
  value String @db.Text

  
  source     String? 
  verified   Boolean   @default(false)
  verifiedBy String? 
  verifiedAt DateTime?

  
  expiresAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, attributeId])
  @@index([userId])
  @@index([attributeId])
  @@index([expiresAt])
  @@map("user_attributes")
}

model ResourceAttribute {
  id          String              @id @default(uuid())
  resourceId  String
  resource    Resource            @relation(fields: [resourceId], references: [id], onDelete: Cascade)
  attributeId String
  attribute   AttributeDefinition @relation(fields: [attributeId], references: [id], onDelete: Cascade)

  
  value String @db.Text

  
  source     String? 
  calculated Boolean @default(false) 

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([resourceId, attributeId])
  @@index([resourceId])
  @@index([attributeId])
  @@map("resource_attributes")
}

enum AttributeType {
  USER
  RESOURCE
  ENVIRONMENT
  COMPOSITE
}

enum AttributeCategory {
  IDENTITY 
  EMPLOYMENT 
  SECURITY 
  CLASSIFICATION 
  METADATA 
  ENVIRONMENT 
  SYSTEM 
}

enum ValueType {
  STRING
  NUMBER
  BOOLEAN
  DATE
  DATETIME
  ENUM
  JSON
}





model MFABackupCode {
  id        String    @id @default(uuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  code      String 
  used      Boolean   @default(false)
  usedAt    DateTime?
  createdAt DateTime  @default(now())

  @@index([userId])
  @@index([userId, used])
  @@map("mfa_backup_codes")
}

model MFAEmergencyToken {
  id        String    @id @default(uuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  token     String    @unique 
  used      Boolean   @default(false)
  usedAt    DateTime?
  expiresAt DateTime
  createdAt DateTime  @default(now())

  @@index([userId])
  @@index([userId, used])
  @@index([expiresAt])
  @@map("mfa_emergency_tokens")
}

model MFAEmailOTP {
  id        String    @id @default(uuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  code      String 
  used      Boolean   @default(false)
  usedAt    DateTime?
  expiresAt DateTime
  sentAt    DateTime  @default(now())
  ipAddress String? 
  createdAt DateTime  @default(now())

  @@index([userId])
  @@index([userId, used, expiresAt])
  @@index([expiresAt])
  @@map("mfa_email_otps")
}





model EncryptionKey {
  id          String      @id @default(uuid())
  keyId       String      @unique 
  category    LogCategory 
  keyMaterial String      @db.Text 
  algorithm   String      @default("AES-256-GCM")
  keySize     Int         @default(256) 
  createdAt   DateTime    @default(now())
  expiresAt   DateTime 
  rotatedAt   DateTime? 
  isActive    Boolean     @default(true)
  hsmKeyId    String? 

  
  usageCount Int       @default(0)
  lastUsedAt DateTime?

  updatedAt DateTime @updatedAt

  @@index([category])
  @@index([isActive])
  @@index([expiresAt])
  @@index([keyId])
  @@map("encryption_keys")
}

model HashChain {
  id             String      @id @default(uuid())
  chainId        String      @unique 
  category       LogCategory 
  previousHash   String? 
  currentHash    String 
  logId          String      @unique 
  log            AuditLog    @relation(fields: [logId], references: [id], onDelete: Cascade)
  sequenceNumber Int 
  createdAt      DateTime    @default(now())

  @@index([chainId])
  @@index([category])
  @@index([logId])
  @@index([sequenceNumber])
  @@map("hash_chains")
}

model LogBatch {
  id                 String      @id @default(uuid())
  batchId            String      @unique
  category           LogCategory
  logIds             String[] 
  signature          String      @db.Text 
  signatureAlgorithm String      @default("RSA-SHA256")
  signedBy           String? 
  signedAt           DateTime    @default(now())
  verified           Boolean     @default(false)
  verifiedAt         DateTime?
  createdAt          DateTime    @default(now())

  @@index([batchId])
  @@index([category])
  @@index([signedAt])
  @@map("log_batches")
}

model LogAnomaly {
  id          String    @id @default(uuid())
  anomalyType String 
  severity    String 
  logId       String? 
  description String    @db.Text
  detectedAt  DateTime  @default(now())
  resolved    Boolean   @default(false)
  resolvedAt  DateTime?
  resolvedBy  String?
  metadata    Json? 

  @@index([anomalyType])
  @@index([severity])
  @@index([detectedAt])
  @@index([resolved])
  @@map("log_anomalies")
}

model SIEMIntegration {
  id           String    @id @default(uuid())
  name         String    @unique
  type         String 
  endpoint     String 
  apiKey       String?   @db.Text 
  enabled      Boolean   @default(true)
  lastSyncAt   DateTime?
  syncInterval Int       @default(3600) 
  filters      Json? 
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([enabled])
  @@index([type])
  @@map("siem_integrations")
}

model ScheduledReport {
  id         String          @id @default(uuid())
  reportType ReportType
  frequency  ReportFrequency
  recipients String[] 

  
  filters Json? 
  format  String @default("PDF") 

  
  nextRunAt DateTime
  lastRunAt DateTime?
  enabled   Boolean   @default(true)

  
  lastReportData Json? 

  executions ReportExecution[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([reportType])
  @@index([frequency])
  @@index([enabled])
  @@index([nextRunAt])
  @@map("scheduled_reports")
}





model Alert {
  id        String        @id @default(uuid())
  alertType AlertType
  severity  AlertSeverity
  title     String
  message   String        @db.Text
  category  AlertCategory

  
  sourceType String? 
  sourceId   String? 

  
  recipients String[] 
  channels   AlertChannel[] 

  
  status         AlertStatus @default(PENDING)
  acknowledged   Boolean     @default(false)
  acknowledgedBy String?
  acknowledgedAt DateTime?

  
  resolved        Boolean   @default(false)
  resolvedBy      String?
  resolvedAt      DateTime?
  resolutionNotes String?   @db.Text

  
  metadata    Json? 
  sourceLogId String? 
  sourceLog   AuditLog? @relation(fields: [sourceLogId], references: [id])
  createdAt   DateTime  @default(now())
  sentAt      DateTime?

  @@index([alertType])
  @@index([severity])
  @@index([category])
  @@index([status])
  @@index([acknowledged])
  @@index([resolved])
  @@index([createdAt])
  @@map("alerts")
}

model DashboardAlert {
  id        String        @id @default(uuid())
  alertType String 
  severity  AlertSeverity
  title     String
  message   String        @db.Text
  category  AlertCategory

  
  data Json? 

  
  active      Boolean   @default(true)
  dismissed   Boolean   @default(false)
  dismissedBy String?
  dismissedAt DateTime?

  
  startDate DateTime
  endDate   DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([alertType])
  @@index([severity])
  @@index([active])
  @@index([dismissed])
  @@index([startDate, endDate])
  @@map("dashboard_alerts")
}

model ReportExecution {
  id       String          @id @default(uuid())
  reportId String
  report   ScheduledReport @relation(fields: [reportId], references: [id], onDelete: Cascade)

  status      ReportStatus @default(RUNNING)
  startedAt   DateTime     @default(now())
  completedAt DateTime?

  
  reportData Json?
  reportUrl  String? 

  errorMessage String? @db.Text

  createdAt DateTime @default(now())

  @@index([reportId])
  @@index([status])
  @@index([startedAt])
  @@map("report_executions")
}

enum AlertType {
  
  MULTIPLE_FAILED_LOGINS
  UNAUTHORIZED_ACCESS
  CRITICAL_SYSTEM_ERROR
  BACKUP_FAILURE

  
  UNUSUAL_ACCESS_PATTERN
  POLICY_VIOLATION_TREND
  PERFORMANCE_DEGRADATION
  COMPLIANCE_GAP

  
  CUSTOM
}

enum AlertSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum AlertCategory {
  SECURITY
  SYSTEM
  COMPLIANCE
  PERFORMANCE
  BACKUP
}

enum AlertChannel {
  EMAIL
  SMS
  DASHBOARD
  WEBHOOK
}

enum AlertStatus {
  PENDING
  SENT
  FAILED
  CANCELLED
}

enum ReportType {
  
  DAILY_SECURITY_SUMMARY
  WEEKLY_COMPLIANCE
  MONTHLY_AUDIT_REVIEW
  QUARTERLY_RISK_ASSESSMENT
  CUSTOM

  
  ACCESS_CONTROL_REVIEW
  USER_PERMISSION
  DATA_ACCESS_AUDIT
  POLICY_COMPLIANCE

  
  THREAT_INTELLIGENCE
  VULNERABILITY_ASSESSMENT
  SECURITY_INCIDENT
  RISK_ASSESSMENT

  
  VISITOR_STATISTICS
  SYSTEM_PERFORMANCE
  BACKUP_SUCCESS
  USER_ACTIVITY
}

enum ReportFrequency {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  CUSTOM
}

enum ReportStatus {
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
}





model DisasterRecoveryPlan {
  id          String  @id @default(uuid())
  name        String
  description String? @db.Text

  
  systemType SystemType
  rto        Int 
  rpo        Int 

  
  procedures    Json 
  prerequisites Json? 

  
  backupIds String[] 
  backups   BackupLog[] @relation 

  
  recoveryTeam Json? 
  contactList  Json? 

  
  vendorContacts Json? 

  
  regulatoryProcedures Json? 

  
  lastTested   DateTime?
  nextTestDate DateTime?
  testResults  Json? 

  
  enabled Boolean @default(true)

  executions RecoveryExecution[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([systemType])
  @@index([enabled])
  @@index([nextTestDate])
  @@map("disaster_recovery_plans")
}

model RecoveryExecution {
  id     String               @id @default(uuid())
  planId String
  plan   DisasterRecoveryPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  
  initiatedBy String
  startedAt   DateTime  @default(now())
  completedAt DateTime?

  
  status      RecoveryStatus @default(IN_PROGRESS)
  currentStep Int            @default(0)
  totalSteps  Int

  
  success      Boolean?
  errorMessage String?  @db.Text
  executionLog Json? 

  createdAt DateTime @default(now())

  @@index([planId])
  @@index([status])
  @@index([startedAt])
  @@map("recovery_executions")
}

enum SystemType {
  CRITICAL 
  IMPORTANT 
  NON_CRITICAL 
}

enum RecoveryStatus {
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
  PAUSED
}





model SecurityIncident {
  id          String @id @default(uuid())
  title       String
  description String @db.Text

  
  severity IncidentSeverity
  category IncidentCategory
  status   IncidentStatus   @default(OPEN)

  
  detectedAt DateTime @default(now())
  reportedBy String? 
  assignedTo String? 

  
  playbookId       String? 
  responseSteps    Json? 
  communicationLog Json? 

  
  resolvedAt      DateTime?
  resolvedBy      String?
  resolutionNotes String?   @db.Text

  
  reviewedAt     DateTime?
  reviewedBy     String?
  reviewNotes    String?   @db.Text
  lessonsLearned String?   @db.Text

  
  relatedLogIds String[] 
  relatedUserId String? 

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([severity])
  @@index([category])
  @@index([status])
  @@index([detectedAt])
  @@index([assignedTo])
  @@map("security_incidents")
}

model IncidentPlaybook {
  id          String           @id @default(uuid())
  name        String           @unique
  description String?          @db.Text
  category    IncidentCategory

  
  steps Json 

  
  templates Json? 

  
  enabled Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@index([enabled])
  @@map("incident_playbooks")
}

model SystemHealth {
  id String @id @default(uuid())

  
  status         HealthStatus @default(HEALTHY)
  cpuUsage       Float? 
  memoryUsage    Float? 
  diskUsage      Float? 
  networkLatency Int? 

  
  databaseStatus String? 
  apiStatus      String? 
  backupStatus   String? 

  
  activeThreats  Int @default(0)
  failedLogins   Int @default(0)
  activeSessions Int @default(0)

  
  recordedAt DateTime @default(now())

  @@index([status])
  @@index([recordedAt])
  @@map("system_health")
}

model ThreatIntelligence {
  id String @id @default(uuid())

  
  threatType  ThreatType
  severity    ThreatSeverity
  source      String? 
  description String         @db.Text

  
  ipAddress String?
  country   String?
  region    String?

  
  status    ThreatStatus @default(ACTIVE)
  blocked   Boolean      @default(false)
  blockedAt DateTime?

  
  detectedAt DateTime @default(now())
  detectedBy String? 

  
  resolvedAt DateTime?
  resolvedBy String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([threatType])
  @@index([severity])
  @@index([status])
  @@index([detectedAt])
  @@index([ipAddress])
  @@map("threat_intelligence")
}

enum IncidentSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum IncidentCategory {
  SECURITY_BREACH
  DATA_LEAK
  UNAUTHORIZED_ACCESS
  MALWARE
  DDoS
  PHISHING
  INSIDER_THREAT
  POLICY_VIOLATION
  SYSTEM_COMPROMISE
  OTHER
}

enum IncidentStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
  FALSE_POSITIVE
}

enum HealthStatus {
  HEALTHY
  WARNING
  CRITICAL
  UNKNOWN
}

enum ThreatType {
  MALICIOUS_IP
  SUSPICIOUS_ACTIVITY
  BRUTE_FORCE
  SQL_INJECTION
  XSS_ATTACK
  DDoS
  MALWARE
  PHISHING
  UNAUTHORIZED_ACCESS
  DATA_EXFILTRATION
  OTHER
}

enum ThreatSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ThreatStatus {
  ACTIVE
  INVESTIGATING
  MITIGATED
  RESOLVED
  FALSE_POSITIVE
}





model Report {
  id          String     @id @default(uuid())
  reportType  ReportType
  reportName  String
  description String?    @db.Text

  
  reportData Json 
  filters    Json? 

  
  format   ReportFormat @default(JSON)
  fileUrl  String? 
  fileSize BigInt? 

  
  generatedBy String
  generatedAt DateTime  @default(now())
  startDate   DateTime? 
  endDate     DateTime? 

  
  status       ReportGenerationStatus @default(GENERATING)
  errorMessage String?                @db.Text

  
  scheduleId String?
  schedule   ReportSchedule? @relation(fields: [scheduleId], references: [id])

  
  templateId String?
  template   ReportTemplate? @relation(fields: [templateId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([reportType])
  @@index([status])
  @@index([generatedBy])
  @@index([generatedAt])
  @@index([scheduleId])
  @@map("reports")
}

model ReportTemplate {
  id          String     @id @default(uuid())
  name        String     @unique
  description String?    @db.Text
  reportType  ReportType

  
  templateConfig Json 

  
  defaultFilters Json?

  
  enabled Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  reports   Report[]
  schedules ReportSchedule[]

  @@index([reportType])
  @@index([enabled])
  @@map("report_templates")
}

model ReportSchedule {
  id          String  @id @default(uuid())
  name        String  @unique
  description String? @db.Text

  
  reportType ReportType
  templateId String?
  template   ReportTemplate?   @relation(fields: [templateId], references: [id])
  frequency  ScheduleFrequency
  dayOfWeek  Int? 
  dayOfMonth Int? 
  time       String? 

  
  recipients String[] 

  
  enabled   Boolean   @default(true)
  lastRunAt DateTime?
  nextRunAt DateTime?

  reports Report[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([reportType])
  @@index([enabled])
  @@index([nextRunAt])
  @@map("report_schedules")
}

enum ReportFormat {
  JSON
  CSV
  PDF
  EXCEL
  HTML
}

enum ReportGenerationStatus {
  GENERATING
  COMPLETED
  FAILED
  EXPIRED
}

enum ScheduleFrequency {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
  ON_DEMAND
}





model Area {
  id                String         @id @default(uuid())
  name              String         @unique
  description       String?        @db.Text
  zone              String 
  securityLevel     SecurityLevel  @default(INTERNAL)
  requiresEscort    Boolean        @default(false)
  requiresClearance Boolean        @default(false)
  minClearance      SecurityLevel? 

  
  enabled Boolean @default(true)

  
  visitorAccess VisitorAreaAccess[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([zone])
  @@index([securityLevel])
  @@index([enabled])
  @@map("areas")
}

model VisitorAreaAccess {
  id        String  @id @default(uuid())
  visitorId String
  visitor   Visitor @relation(fields: [visitorId], references: [id], onDelete: Cascade)
  areaId    String
  area      Area    @relation(fields: [areaId], references: [id], onDelete: Cascade)

  
  grantedAt     DateTime  @default(now())
  expiresAt     DateTime 
  revokedAt     DateTime?
  revokedBy     String?
  revokedReason String?   @db.Text

  
  requiresEscort Boolean @default(false)
  escortId       String? 
  escorted       Boolean @default(false)

  
  active Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([visitorId])
  @@index([areaId])
  @@index([expiresAt])
  @@index([active])
  @@map("visitor_area_access")
}

model VisitorDigitalAccess {
  id        String  @id @default(uuid())
  visitorId String  @unique
  visitor   Visitor @relation(fields: [visitorId], references: [id], onDelete: Cascade)

  
  wifiUsername  String?   @unique
  wifiPassword  String?   @db.Text 
  wifiSSID      String? 
  wifiExpiresAt DateTime?

  
  networkAccessEnabled Boolean  @default(true)
  allowedIPs           String[] 
  blockedIPs           String[] 
  allowedPorts         Int[] 
  blockedPorts         Int[] 
  bandwidthLimit       Int? 

  
  webPortalEnabled Boolean @default(true)
  webPortalUrl     String?
  webPortalToken   String? @unique 

  
  printingEnabled Boolean @default(false)
  printQuota      Int? 
  printUsed       Int     @default(0)

  
  active    Boolean  @default(true)
  expiresAt DateTime 

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([visitorId])
  @@index([wifiUsername])
  @@index([webPortalToken])
  @@index([expiresAt])
  @@index([active])
  @@map("visitor_digital_access")
}
